---
import { getTranslations, type Language, languages } from '../../utils/i18n';

interface Props {
  lang?: Language;
}

const param = Astro.params.lang;
const lang: Language = Astro.props.lang 
  ? Astro.props.lang 
  : (languages.includes(param as Language) ? (param as Language) : 'es');

const t = getTranslations(lang);
---

<div
  id="dev-warning"
  class="fixed top-[73px] left-0 right-0 z-20
         bg-gradient-to-r from-yellow-400 via-amber-400 to-yellow-400 
         dark:from-yellow-500 dark:via-amber-500 dark:to-yellow-500
         shadow-lg border-b-2 border-yellow-500 dark:border-yellow-600
         transition-all duration-300"
>
  <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between gap-4">
    <div class="flex items-center gap-3 flex-1">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
        stroke-width="2"
        stroke="currentColor"
        class="w-5 h-5 text-yellow-800 dark:text-yellow-900 shrink-0"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z"
        />
      </svg>
      <p class="text-sm sm:text-base font-semibold text-yellow-900 dark:text-yellow-950">
        {t.dev_warning || "Esta página web está en desarrollo. Puede contener errores o cambios inesperados."}
      </p>
    </div>
    <button
      id="close-dev-warning"
      aria-label="Cerrar advertencia"
      class="shrink-0 text-yellow-900 dark:text-yellow-950 hover:text-yellow-950 dark:hover:text-yellow-900 transition-colors p-1 rounded-full hover:bg-yellow-500/20 dark:hover:bg-yellow-600/20"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
        stroke-width="2.5"
        stroke="currentColor"
        class="w-5 h-5"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          d="M6 18L18 6M6 6l12 12"
        />
      </svg>
    </button>
  </div>
</div>

<script is:inline>
  (function() {
    if (window.__devWarningInitialized) return;
    window.__devWarningInitialized = true;

    function initDevWarning() {
      const warning = document.getElementById('dev-warning');
      const closeBtn = document.getElementById('close-dev-warning');
      
      if (!warning || !closeBtn) return;

      // Verificar si ya fue cerrado
      if (localStorage.getItem('dev-warning-closed') === 'true') {
        warning.style.display = 'none';
        return;
      }

      // Asegurar que el main tenga padding-top para compensar el banner
      function adjustMainPadding() {
        const main = document.querySelector('main');
        if (main && warning.style.display !== 'none') {
          const warningHeight = warning.offsetHeight || 56; // Fallback a ~56px
          main.style.paddingTop = `${warningHeight}px`;
        }
      }

      // Ajustar padding después de que el DOM esté completamente cargado
      setTimeout(adjustMainPadding, 100);

      closeBtn.addEventListener('click', () => {
        warning.style.opacity = '0';
        warning.style.transform = 'translateY(-100%)';
        setTimeout(() => {
          warning.style.display = 'none';
          localStorage.setItem('dev-warning-closed', 'true');
          
          // Restaurar el padding del main
          const main = document.querySelector('main');
          if (main) {
            main.style.paddingTop = '0';
          }
        }, 300);
      });
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initDevWarning);
    } else {
      initDevWarning();
    }
  })();
</script>
