---
export const prerender = false;

import { isValidLanguage, type Language } from "@/utils/i18n";

// Check for language in cookies
const cookieLang = Astro.cookies.get("lang")?.value;

if (cookieLang && isValidLanguage(cookieLang)) {
    return Astro.redirect(`/${cookieLang}/`);
}

// Check for language in Accept-Language header
const acceptLanguage = Astro.request.headers.get("accept-language");

let lang: Language = "es";

if (acceptLanguage) {
    const browserLang = acceptLanguage.split(",")[0].split("-")[0];

    if (isValidLanguage(browserLang)) {
        lang = browserLang;
    }
}

return Astro.redirect(`/${lang}/`);
---
